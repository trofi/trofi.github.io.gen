---
title: "Inline graphviz dot in hakyll"
date: October 06, 2023
root: "http://trofi.github.io"
---

[A while ago](https://github.com/trofi/trofi.github.io.gen/commit/0872d9dc50c9d15b50ceda16d408a45e5655c913)
I added `.dot` file support into this blog and used it on
["How do shared library collisions break?"](/posts/248-how-do-shared-library-collisions-break.html)
post.
The change was very easy and helped me a bit to add more visual arrows
into posts that came after.
The result was fine for larger `.dot` files, but one-liners were a bit
clumsy to insert into a standalone external file. I tried to add a
quick support for inline `.dot` syntax and failed.

But today I had enough time to actually finish it and behold!


```{render=dot}
digraph {
  node [shape=box]
  B [shape=egg]
  A -> B [label="I am dotted" style=dotted color=red]
  A -> C [solor=blue]
  B -> C -> A [color=green]
}
```

This is generated by the following snippet:

````dot
```{render=dot}
digraph {
  node [shape=box]
  B [shape=egg]
  A -> B [label="I am dotted" style=dotted color=red]
  A -> C [solor=blue]
  B -> C -> A [color=green]
}
```
````

The [full change](https://github.com/trofi/trofi.github.io.gen/commit/1329f12fb75572007cc7dcdc0f980fdd7ba176d7)
ended up being very small thanks to `pandoc` and `hakyll` `unixFilter`:

```haskell
inlineDotWithGrapthviz :: TP.Pandoc -> Compiler TP.Pandoc
inlineDotWithGrapthviz = TPW.walkM inlineDot

inlineDot :: TP.Block -> Compiler TP.Block
inlineDot cb@(TP.CodeBlock (id, classes, namevals) contents)
  | lookup "render" namevals == Just "dot"
  = TP.RawBlock (TP.Format "html") . DT.pack <$> (unixFilter "dot" ["-Tsvg"] (DT.unpack contents))
inlineDot x = return x
```

Here we traverse the `pandoc` representation of `markdown` and substitute
`{render=dot}` for the raw output of `dot -Tsvg` tool call. Easy!

If you never saw what `graphviz` is capable have a loot at
[their gallery](https://graphviz.org/gallery/).

Have fun!
